Other objects in the database (synonym, sequence, database link)
-----------------------------
(DBA_SYNONYMS, DBA_VIEWS, DBA_SEQUENCES, DBA_DB_LINKS)

------------------------------------------------------------------------------
Give the following query (in ARAMIS database):
  SELECT * FROM sz1;
Is there a table named 'sz1' ? (Answer -> no)
Then which is the table (owner, table_name) whose records are displayed?
You should find a table, a view is not enough.

SELECT * from dba_objects where lower(object_name) like 'sz1%';
SELECT * FROM DBA_SYNONYMS WHERE owner='PUBLIC' AND synonym_name like'SZ1%';
SELECT * from dba_objects where lower(object_name) like 'v1%' and owner='NIKOVITS';
SELECT view_name, text FROM DBA_VIEWS WHERE owner='NIKOVITS' AND view_name='V1';
SELECT * from dba_objects where lower(object_name) like 'employ%' and owner='NIKOVITS';
------------------------------------------------------------------------------
Create your own copy of EMP and DEPT tables (if you don't have already).
CREATE TABLE emp AS SELECT * FROM nikovits.emp;
CREATE TABLE dept AS SELECT * FROM nikovits.dept;

Create a sequence to generate numbers for department number columns of the tables.
(start with 50, increment by 10)
INSERT 2 new departments and 3 employees for each department. The department numbers
should be generated by the sequence.
-------------------------------------------------------------------------------
We have two Oracle databases ARAMIS and ULLMAN. 
Create a database link in database ULLMAN pointing to database ARAMIS with the 
following statement:

CREATE DATABASE LINK aramis CONNECT TO username IDENTIFIED BY password       -- your username/password
USING 'aramis.inf.elte.hu:1521/aramis.inf.elte.hu';

Query a table in database ARAMIS while connecting to ULLMAN:

SELECT * FROM nikovits.emp@aramis;

See the following two tables about countries and rivers:

NIKOVITS.countries_v   in Aramis database  
  interesting columns: tld (key) and cname
NIKOVITS.rivers_v      in Ullman database 
  interesting columns: rname and countries (comma separated tld)

 Give the names of countries through which the Mekong flows.

SELECT r.rname, c.cname, c.tld, r.countries 
FROM NIKOVITS.countries_v@aramis c, NIKOVITS.rivers_v r
WHERE r.rname = 'Mekong' AND r.countries LIKE '%'||c.tld||'%';

*Give the names of countries in the order of flowing (down the river). -> see function INSTR
---------------------------------------------------------------------------------


Oracle storage concepts
-----------------------
(DBA_TABLES, DBA_DATA_FILES, DBA_TEMP_FILES, DBA_TABLESPACES, DBA_SEGMENTS, DBA_EXTENTS, DBA_FREE_SPACE)

Give the names and sizes of database files.
SELECT file_name, bytes FROM dba_data_files;

Give the names of tablespaces.
SELECT tablespace_name FROM dba_tablespaces;

Which datafile belongs to which tablespace? (filename, tablespace_name)
SELECT file_name, tablespace_name FROM dba_data_files;

Is there a tablespace that doesn't have datafiles? -> see temp_files
SELECT tablespace_name FROM dba_tablespaces WHERE tablespace_name NOT IN
 (SELECT tablespace_name FROM dba_data_files);
SELECT file_name, tablespace_name FROM dba_temp_files;

What is the block size in USERS tablespace?

Find some segments whose owner is NIKOVITS. What segment types do they have? List the types.
SELECT segment_name, segment_type FROM dba_segments WHERE owner='NIKOVITS';
SELECT distinct segment_type FROM dba_segments WHERE owner='NIKOVITS';

How many extents there are in file 'users02.dbf' ?
SELECT * from dba_data_files where file_name like '%/users02%';
SELECT * from dba_extents where file_id=2;                      -- if file_id is 2
SELECT count(*) from dba_extents where file_id=2;
-- We combine the previous queries together:
SELECT count(*) FROM dba_data_files f, dba_extents e
WHERE file_name like '%/users02%' AND f.file_id=e.file_id;

How many bytes do they (extents in the file) occupy?
SELECT sum(e.bytes) FROM dba_data_files f, dba_extents e
WHERE file_name LIKE '%/users02%' AND f.file_id=e.file_id;

How many free extents there are in file 'users02.dbf', and what is the summarized size of them ?
SELECT count(fr.bytes), sum(fr.bytes), f.bytes 
FROM dba_data_files f, dba_free_space fr
WHERE file_name LIKE '%/users02%' AND f.file_id=fr.file_id
GROUP BY f.bytes;

How many percentage of file 'users02.dbf' is full (allocated to some object)?
SELECT sum(e.bytes)/f.bytes FROM dba_data_files f, dba_extents e
WHERE file_name LIKE '%/users02%' AND f.file_id=e.file_id
GROUP BY f.bytes;

Who is the owner whose objects (e.g. INDEXES) occupy the most space in the database?
--> the first row will show
SELECT owner, sum(bytes) from dba_segments 
WHERE segment_type = 'INDEX'
GROUP BY owner order by 2 desc;

-- If we want only the first row:
SELECT * FROM 
 (select owner, sum(bytes) from dba_segments 
  where segment_type = 'INDEX'
  group by owner order by 2 desc)
WHERE rownum < 2;

Is there a table of owner NIKOVITS that has extents in more than one datafile? (Aramis)
SELECT segment_name, count(distinct file_id)
FROM dba_extents WHERE owner='NIKOVITS' AND segment_type='TABLE'
GROUP BY segment_name HAVING count(distinct file_id) > 1;

Select one from the above tables (e.g. tabla_123) and give the occupied
space by files. (filename, bytes)

On which tablespace is table ORAUSER.dolgozo?
On which tablespace is table NIKOVITS.eladasok? Why NULL?  (Ullman database)
-------------------------------------------------------
Write a PL/SQL procedure, which prints out for the parameter user his/her oldest table (which was created earliest)
the size of the table in bytes (the size of the table's segment) and the creation date. (table_name, bytes, created)
CREATE OR REPLACE PROCEDURE oldest_table(p_user VARCHAR2) IS 
...
SET SERVEROUTPUT ON
EXECUTE oldest_table('ORAUSER');

Hint:
Find the creation date of the object (table) in DBA_OBJECTS, then find the segment(s) of the table
in DBA_SEGMENTS.



